<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
  <head>
    
    <!-- Relative Navigation -->
    
    <link rel="up" href="Macros" />
    <link rel="prev" href="Macro_Names" />
    <link rel="next" href="Patterns" />
    
    <!-- Absolute Navigation -->
    
    <link rel="top" href="Title" />
    <link rel="start first" href="." />
    <link rel="copyright" href="Copyrights" />
    <link rel="contents" href="Contents" />
    <link rel="glossary" href="Glossary" />
    <link rel="index" href="Index" />
    <link rel="last author" href="Colophon" />
    
    <!-- Chapters -->
    
    <link rel="chapter" title="About This Book" href="Preface" />
    <link rel="chapter" title="1 Introduction" href="Introduction" />
    <link rel="chapter" title="2 Syntax" href="Syntax" />
    <link rel="chapter" title="3 Program Structure" href="Program_Structure" />
    <link rel="chapter" title="4 Program Control" href="Program_Control" />
    <link rel="chapter" title="5 Types and Classes" href="Types_and_Classes" />
    <link rel="chapter" title="6 Functions" href="Functions" />
    <link rel="chapter" title="7 Conditions" href="Conditions" />
    <link rel="chapter" title="8 Collections" href="Collections" />
    <link rel="chapter" title="9 Sealing" href="Sealing" />
    <link rel="chapter" title="10 Macros" href="Macros" />
    <link rel="chapter" title="11 The Built-In Classes" href="Built-In_Classes" />
    <link rel="chapter" title="12 The Built-In Functions" href="Built-In_Functions" />
    <link rel="chapter" title="13 Other Built-In Objects" href="Other_Built-In_Objects" />
    <link rel="chapter" title="14 The Built-In Macros and Special Definitions" href="Built-In_Macros_and_Special_Definitions" />
    
    <!-- Appendices -->
    
    <link rel="appendix" title="A BNF" href="BNF" />
    <link rel="appendix" title="B Exported Names" href="Exported_Names" />
    
    <!-- Stylesheets -->
    
    <link rel="stylesheet" href="styles/common.css" type="text/css" />
    <link rel="stylesheet" href="styles/nav-top-fixed.css" type="text/css" media="handheld" />
    <link rel="stylesheet" href="styles/nav-left-fixed.css" type="text/css" media="screen" title="Navigation at Left" />
    <link rel="stylesheet alternate" href="styles/nav-top-fixed.css" type="text/css" media="screen" title="Navigation at Top" />

    <title>Rewrite Rules &mdash; 10. Macros &mdash; The DRM</title>
  </head>
  <body class="content">

    <div id="header">
      <div id="navigation-header">
	<div id="navigation-top">
	  <div class="background">
	    <p id="book-title">
	    <img class="book-icon" alt="" src="images/color-square-small.png" width="22" height="21" />
	    <a href="Title"><img class="book-title" alt="The Dylan Reference Manual" src="images/book-title.png" width="343" height="28" /></a>
	  </p>
	  <p id="navigation-core">
	    <a class="previous" accesskey="p" title="Previous Page" href="Macro_Names"><span>&larr; Previous</span></a>
	    <a class="next" accesskey="n" title="Next Page" href="Patterns"><span>Next Page &rarr;</span></a>
	    <a class="up" accesskey="u" title="Chapter Start" href="Macros"><span>Up</span></a>
	    <a class="start" accesskey="s" title="Start of Book" href="Title"><span>Start</span></a>
	    <a class="contents" accesskey="c" title="Contents" href="Contents"><span>Contents</span></a>
	    <a class="index" accesskey="i" title="Index" href="Index"><span>Index</span></a>
	  </p>
	</div>
	</div>
	<div id="navigation-TOC">
	  <ul class="front-matter">
	    <li id="book-start"><a href="Title">Start</a></li>
	    <li><a href="Contents">Contents</a></li>
	    <li><a href="Preface">About This Book</a></li>
	  </ul>
	  <ol class="chapters">
	    <li><a href="Introduction">Introduction</a></li>
	    <li><a href="Syntax">Syntax</a></li>
	    <li><a href="Program_Structure">Program Structure</a></li>
	    <li><a href="Program_Control">Program Control</a></li>
	    <li><a href="Types_and_Classes">Types and Classes</a></li>
	    <li><a href="Functions">Functions</a></li>
	    <li><a href="Conditions">Conditions</a></li>
	    <li><a href="Collections">Collections</a></li>
	    <li><a href="Sealing">Sealing</a></li>
	    <li class="current parent"><a href="Macros">Macros</a>
	      <ul class="sections">
		<li><a href="Macros_Overview">Overview</a></li>
		<li><a href="Extensible_Grammar">Extensible Grammar</a></li>
		<li><a href="Macro_Names">Macro Names</a></li>
		<li id="current"><a href="Rewrite_Rules">Rewrite Rules</a></li>
		<li><a href="Patterns">Patterns</a></li>
		<li><a href="Pattern_Variable_Constraints">Pattern Variable Constraints</a></li>
		<li><a href="Templates">Templates</a></li>
		<li><a href="Auxiliary_Rule_Sets">Auxiliary Rule Sets</a></li>
		<li><a href="Hygiene">Hygiene</a></li>
		<li><a href="Rewrite_Rule_Examples">Rewrite Rule Examples</a></li>
	      </ul>
	    </li>
	    <li><a href="Built-In_Classes">The Built-In Classes</a></li>
	    <li><a href="Built-In_Functions">The Built-In Functions</a></li>
	    <li><a href="Other_Built-In_Objects">Other Built-In Objects</a></li>
	    <li><a href="Built-In_Macros_and_Special_Definitions">The Built-In Macros and Special Definitions</a></li>
	  </ol>
	  <ol class="appendices">
	    <li><a href="BNF">BNF</a></li>
	    <li><a href="Exported_Names">Exported Names</a></li>
	  </ol>
	  <ul class="back-matter">
	    <li><a href="Glossary">Glossary</a></li>
	    <li><a href="Index">Index</a></li>
	    <li><a href="Colophon">Colophon</a></li>
	  </ul>
	  <ul class="errata">
	    <li><a href="Errata">Errata</a></li>
	  </ul>
	</div>
      </div>

      <hr />

    </div>

    <div id="content">
      <div id="section-header">
	<p id="section-prefix">Chapter 10</p>
	<p id="section-name">Macros</p>
      </div>

      <a name="HEADING-80-0"></a>
      <a name="UID-Macros-1609"></a>
      <h1 class="section-title"><a name="IX-1234">Rewrite Rules</a></h1>
      <p>The grammar of a macro definition
	is <span class="BNF"><code>define</code> <code>macro</code>
	  <var>macro-definition</var></span>. For details see
	<a href="BNF">Appendix A, <q>BNF.</q></a></p>
      <p>If the optional <em class="BNFCaps">name</em> at the end of a <var>macro-definition</var>
	is present, it must be the same <em class="BNFCaps">name</em> that appears at the beginning
	of the <var>macro-definition</var>.</p>
      <p>The kind of macro being defined, and thus the Dylan grammar production that this macro
	extends, is determined by which kind of rules appear in the
	macro's <var>main-rule-set</var>.</p>
      <p>The <em class="BNFCaps">name</em> preceding the <var>main-rule-set</var> is the name of the
	binding whose value is this macro. It must be consistent with each left-hand side of
	the <var>main-rule-set</var>. It can be any name, even a reserved word or backslash followed
	by an operator. For statement and function macros this <em class="BNFCaps">name</em> must be
	the same as the <em class="BNFCaps">name</em> that appears as the first token in
	each <var>main-rule-set</var> pattern. For definition macros
	this <em class="BNFCaps">name</em> must be the same as the <em class="BNFCaps">name</em> in
	the <var>xxx-style-definition-rule</var> with the suffix <q><code>-definer</code></q>
	added.</p>
      <p>A <em class="BNFCaps">name</em> can belong to more than one of the lexical
	categories <em class="BNFCaps">begin-word</em>, <em class="BNFCaps">function-word</em>,
	<em class="BNFCaps">define-body-word</em>, and <em class="BNFCaps">define-list-word</em>.
	A <em class="BNFCaps">name</em> cannot belong to both <em class="BNFCaps">begin-word</em>
	and <em class="BNFCaps">function-word</em>. A <em class="BNFCaps">name</em> cannot belong to
	both <em class="BNFCaps">define-body-word</em>
	and <em class="BNFCaps">define-list-word</em>.</p>
      <p>For simplicity of documentation, the <var>xxx-style-definition-rule</var> productions are
	written ambiguously. The <em class="BNFCaps">name</em> in the left-hand side of the rule
	must be the <em class="BNFCaps">name</em> immediately following <code>define macro</code>
	with the <q><code>-definer</code></q> suffix removed, not an
	arbitrary <em class="BNFCaps">name</em>, which would be ambiguous
	with <var>modifier</var>.</p>
      <p>The general idea is that the <var>main-rule-set</var> is an ordered sequence of rewrite
	rules. Macro expansion tests the macro call against each left-hand side in turn until one
	matches. The corresponding right-hand side supplies the new construct to replace the macro
	call. The left- and right-hand sides can contain pattern variables. The portion of the macro
	call that matches a particular pattern variable on the left replaces each occurrence of that
	pattern variable on the right. It is an error for the right-hand side of a rule to contain a
	pattern variable that does not appear on the left-hand side of the same rule.</p>
      <p>If none of the left-hand sides match, the macro call is invalid. If more than one left-hand
	side matches, the first matching rule is used. Note that (as described in the next section)
	a pattern variable with a <a name="IX-1235">wildcard constraint</a> can match an empty
	portion of the macro call. A comma or a semicolon followed by a pattern variable with a
	wildcard constraint also can match an empty portion of the macro call. Do not assume that
	only an empty pattern can match an empty input. In general when writing recursive rewrite
	rules it is better to put the base case first, before the inductive cases, in case an
	inductive case rewrite rule might match a base case input.</p>
      <p>The punctuation marks <code>?</code>, <code>??</code>, and <code>?=</code> used in patterns
	and templates are customarily written without any whitespace following
	them.<a name="IX-1236"></a></p>

    </div>

    <div id="footer">

      <hr />
      <address>The Dylan Reference Manual - 7 Apr 1998</address>
      <p id="navigation-footer">
	<a class="previous" accesskey="p" title="Previous Page" href="Macro_Names"><span>&larr; Previous</span></a>
	<a class="next" accesskey="n" title="Next Page" href="Patterns"><span>Next Page &rarr;</span></a>
	<a class="up" accesskey="u" title="Chapter Start" href="Macros"><span>Up</span></a>
	<a class="start" accesskey="s" title="Start of Book" href="Title"><span>Start</span></a>
	<a class="contents" accesskey="c" title="Contents" href="Contents"><span>Contents</span></a>
	<a class="index" accesskey="i" title="Index" href="Index"><span>Index</span></a>
      </p>
      <p>Copyright Apple Computer, Inc. 1996. Apple&reg; and the Apple logo are registered
	trademarks of Apple Computer, Inc. Used with permission. All Rights Reserved.</p>
      <p>Originally generated with Harlequin WebMaker&reg;, subsequently revised.</p>
    </div>
  </body>
</html>
