<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
  <head>
    
    <!-- Relative Navigation -->
    
    <link rel="up" href="Macros" />
    <link rel="prev" href="Pattern_Variable_Constraints" />
    <link rel="next" href="Auxiliary_Rule_Sets" />
    
    <!-- Absolute Navigation -->
    
    <link rel="top" href="Title" />
    <link rel="start first" href="." />
    <link rel="copyright" href="Copyrights" />
    <link rel="contents" href="Contents" />
    <link rel="glossary" href="Glossary" />
    <link rel="index" href="Index" />
    <link rel="last author" href="Colophon" />
    
    <!-- Chapters -->
    
    <link rel="chapter" title="About This Book" href="Preface" />
    <link rel="chapter" title="1 Introduction" href="Introduction" />
    <link rel="chapter" title="2 Syntax" href="Syntax" />
    <link rel="chapter" title="3 Program Structure" href="Program_Structure" />
    <link rel="chapter" title="4 Program Control" href="Program_Control" />
    <link rel="chapter" title="5 Types and Classes" href="Types_and_Classes" />
    <link rel="chapter" title="6 Functions" href="Functions" />
    <link rel="chapter" title="7 Conditions" href="Conditions" />
    <link rel="chapter" title="8 Collections" href="Collections" />
    <link rel="chapter" title="9 Sealing" href="Sealing" />
    <link rel="chapter" title="10 Macros" href="Macros" />
    <link rel="chapter" title="11 The Built-In Classes" href="Built-In_Classes" />
    <link rel="chapter" title="12 The Built-In Functions" href="Built-In_Functions" />
    <link rel="chapter" title="13 Other Built-In Objects" href="Other_Built-In_Objects" />
    <link rel="chapter" title="14 The Built-In Macros and Special Definitions" href="Built-In_Macros_and_Special_Definitions" />
    
    <!-- Appendices -->
    
    <link rel="appendix" title="A BNF" href="BNF" />
    <link rel="appendix" title="B Exported Names" href="Exported_Names" />
    
    <!-- Stylesheets -->
    
    <link rel="stylesheet" href="styles/common.css" type="text/css" />
    <link rel="stylesheet" href="styles/nav-top-fixed.css" type="text/css" media="handheld" />
    <link rel="stylesheet" href="styles/nav-left-fixed.css" type="text/css" media="screen" title="Navigation at Left" />
    <link rel="stylesheet alternate" href="styles/nav-top-fixed.css" type="text/css" media="screen" title="Navigation at Top" />

    <title>Templates &mdash; 10. Macros &mdash; The DRM</title>
  </head>
  <body class="content">

    <div id="header">
      <div id="navigation-header">
	<div id="navigation-top">
	  <div class="background">
	    <p id="book-title">
	    <img class="book-icon" alt="" src="images/color-square-small.png" width="22" height="21" />
	    <a href="Title"><img class="book-title" alt="The Dylan Reference Manual" src="images/book-title.png" width="343" height="28" /></a>
	  </p>
	  <p id="navigation-core">
	    <a class="previous" accesskey="p" title="Previous Page" href="Pattern_Variable_Constraints"><span>&larr; Previous</span></a>
	    <a class="next" accesskey="n" title="Next Page" href="Auxiliary_Rule_Sets"><span>Next Page &rarr;</span></a>
	    <a class="up" accesskey="u" title="Chapter Start" href="Macros"><span>Up</span></a>
	    <a class="start" accesskey="s" title="Start of Book" href="Title"><span>Start</span></a>
	    <a class="contents" accesskey="c" title="Contents" href="Contents"><span>Contents</span></a>
	    <a class="index" accesskey="i" title="Index" href="Index"><span>Index</span></a>
	  </p>
	</div>
	</div>
	<div id="navigation-TOC">
	  <ul class="front-matter">
	    <li id="book-start"><a href="Title">Start</a></li>
	    <li><a href="Contents">Contents</a></li>
	    <li><a href="Preface">About This Book</a></li>
	  </ul>
	  <ol class="chapters">
	    <li><a href="Introduction">Introduction</a></li>
	    <li><a href="Syntax">Syntax</a></li>
	    <li><a href="Program_Structure">Program Structure</a></li>
	    <li><a href="Program_Control">Program Control</a></li>
	    <li><a href="Types_and_Classes">Types and Classes</a></li>
	    <li><a href="Functions">Functions</a></li>
	    <li><a href="Conditions">Conditions</a></li>
	    <li><a href="Collections">Collections</a></li>
	    <li><a href="Sealing">Sealing</a></li>
	    <li class="current parent"><a href="Macros">Macros</a>
	      <ul class="sections">
		<li><a href="Macros_Overview">Overview</a></li>
		<li><a href="Extensible_Grammar">Extensible Grammar</a></li>
		<li><a href="Macro_Names">Macro Names</a></li>
		<li><a href="Rewrite_Rules">Rewrite Rules</a></li>
		<li><a href="Patterns">Patterns</a></li>
		<li><a href="Pattern_Variable_Constraints">Pattern Variable Constraints</a></li>
		<li id="current"><a href="Templates">Templates</a></li>
		<li><a href="Auxiliary_Rule_Sets">Auxiliary Rule Sets</a></li>
		<li><a href="Hygiene">Hygiene</a></li>
		<li><a href="Rewrite_Rule_Examples">Rewrite Rule Examples</a></li>
	      </ul>
	    </li>
	    <li><a href="Built-In_Classes">The Built-In Classes</a></li>
	    <li><a href="Built-In_Functions">The Built-In Functions</a></li>
	    <li><a href="Other_Built-In_Objects">Other Built-In Objects</a></li>
	    <li><a href="Built-In_Macros_and_Special_Definitions">The Built-In Macros and Special Definitions</a></li>
	  </ol>
	  <ol class="appendices">
	    <li><a href="BNF">BNF</a></li>
	    <li><a href="Exported_Names">Exported Names</a></li>
	  </ol>
	  <ul class="back-matter">
	    <li><a href="Glossary">Glossary</a></li>
	    <li><a href="Index">Index</a></li>
	    <li><a href="Colophon">Colophon</a></li>
	  </ul>
	  <ul class="errata">
	    <li><a href="Errata">Errata</a></li>
	  </ul>
	</div>
      </div>

      <hr />

    </div>

    <div id="content">
      <div id="section-header">
	<p id="section-prefix">Chapter 10</p>
	<p id="section-name">Macros</p>
      </div>

      <a name="HEADING-83-0"></a>
      <a name="UID-Macros-1805"></a>
      <h1 class="section-title"><a name="IX-1262">Templates</a></h1>
      <p>Approximately speaking, a template has the same structure as what it constructs, but
	contains pattern variables that will be replaced by fragments extracted from the macro
	call. Thus a template in the <var>main-rule-set</var> looks like the macro expansion.</p>
      <p>However, templates do not have a full grammar. A template is essentially any sequence of
	tokens and <var>substitutions</var> in which all of Dylan's brackets are
	balanced: <code>()</code>, <code>[]</code>, <code>{}</code>, <code>#()</code>,
	and <code>#[]</code>. Substitution for pattern variables produces a sequence of tokens and
	other elementary fragments.</p>
      <p>Note that using unparsed token sequences as templates <a name="IX-1263">allows a macro
	expansion to contain macro calls</a> without creating any inter-dependencies between
	macros. Since the template is not parsed at macro definition time, any macros called in the
	template do not have to be defined first, and macros can be compiled independently of each
	other. This simplifies the implementation at the minor cost of deferring some error checking
	from when a macro is defined until the time when the macro is called.</p>
      <p>The grammar for templates is the definition of <var>template </var>
	in <a href="Phrase_Grammar#XREF-2119"><q>Templates</q> on page 429</a>.</p>
      <p>All <var>template-elements</var> other than <var>substitution</var> are copied directly
	into the macro expansion. The various kinds of <var>substitution</var> insert something else
	into the macro expansion, as follows:</p>
      <dl>
	<dt><code>?</code> <em class="BNFCaps">name</em></dt>
	<dd><p>The fragment bound to the pattern variable
	    named <em class="BNFCaps">name</em>.</p></dd>
	<dt><var>name-prefix<em><sub>opt</sub></em></var> <code>?</code> <var>name-string-or-symbol</var> <var>name-suffix<em><sub>opt</sub></em></var></dt>
	<dd><p>The fragment bound to the pattern variable named <var>name-string-or-symbol</var>,
	    converted to a <em class="BNFCaps">string</em> or <em class="BNFCaps">symbol</em> and/or
	    concatenated with a prefix and/or suffix. Note that this rule applies only when the
	    first rule does not. The fragment must be a <em class="BNFCaps">name</em>. Concatenate
	    the prefix, if any, the characters of the fragment, and the suffix, if any. The
	    alphabetic case of the characters of the fragment is unspecified. Convert this to the
	    same grammatical type (<em class="BNFCaps">name</em>, <em class="BNFCaps">string</em>,
	    or <em class="BNFCaps">symbol</em>) as <var>name-string-or-symbol</var>. When the result
	    is a <em class="BNFCaps">name</em>, its hygiene context is the same as that of the
	    fragment.</p></dd>
	<dt><code>??</code> <em class="BNFCaps">name</em> <var>separator<em><sub>opt</sub></em></var> <code>...</code></dt>
	<dd><p>The sequence of fragments bound to the pattern variable
	    named <em class="BNFCaps">name</em>, with <var>separator</var> inserted between each
	    pair of fragments. The pattern variable must have been bound by
	    a <code>??</code> <var>pattern-keyword.</var> <var>Separator</var> can be a binary
	    operator, comma, or semicolon. If the size of the sequence is 1 or <var>separator</var>
	    is omitted, no separator is inserted. If the sequence is empty, nothing is
	    inserted.</p></dd>
	<dt><code>...</code></dt>
	<dd><p>The fragment bound to the pattern variable that names this rule set; this is only
	    valid in an auxiliary rule set.</p></dd>
	<dt><code>?=</code> <em class="BNFCaps">name</em></dt>
	<dd><p>A reference to <em class="BNFCaps">name</em>, in the lexical context where the macro
	    was called.</p></dd>
      </dl>
      <p>It is an error for a single question-mark <var>substitution</var> to use a pattern variable
	that was bound by a double question-mark <var>pattern-keyword.</var> </p>
      <p>It is an error for a double question-mark <var>substitution</var> to use a pattern variable
	that was bound by a single question-mark <var>pattern-variable</var>
	or <var>pattern-keyword.</var> </p>
      <p>It is an error for a <var>substitution</var> to use a pattern variable that does not appear
	on the left-hand side of the same rule.</p>
      <p>When a template contains a <var>separator</var> immediately followed by
	a <var>substitution</var>, and the fragment inserted into the macro expansion by
	the <var>substitution</var> is empty, the separator is removed from the macro
	expansion.<a name="IX-1264"></a></p>

    </div>

    <div id="footer">

      <hr />
      <address>The Dylan Reference Manual - 7 Apr 1998</address>
      <p id="navigation-footer">
	<a class="previous" accesskey="p" title="Previous Page" href="Pattern_Variable_Constraints"><span>&larr; Previous</span></a>
	<a class="next" accesskey="n" title="Next Page" href="Auxiliary_Rule_Sets"><span>Next Page &rarr;</span></a>
	<a class="up" accesskey="u" title="Chapter Start" href="Macros"><span>Up</span></a>
	<a class="start" accesskey="s" title="Start of Book" href="Title"><span>Start</span></a>
	<a class="contents" accesskey="c" title="Contents" href="Contents"><span>Contents</span></a>
	<a class="index" accesskey="i" title="Index" href="Index"><span>Index</span></a>
      </p>
      <p>Copyright Apple Computer, Inc. 1996. Apple&reg; and the Apple logo are registered
	trademarks of Apple Computer, Inc. Used with permission. All Rights Reserved.</p>
      <p>Originally generated with Harlequin WebMaker&reg;, subsequently revised.</p>
    </div>
  </body>
</html>
