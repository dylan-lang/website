<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
  <head>
    
    <!-- Relative Navigation -->
    
    <link rel="up" href="Built-In_Macros_and_Special_Definitions" />
    <link rel="prev" href="Definition_Macros" />
    <link rel="next" href="Statement_Macros" />
    
    <!-- Absolute Navigation -->
    
    <link rel="top" href="Title" />
    <link rel="start first" href="." />
    <link rel="copyright" href="Copyrights" />
    <link rel="contents" href="Contents" />
    <link rel="glossary" href="Glossary" />
    <link rel="index" href="Index" />
    <link rel="last author" href="Colophon" />
    
    <!-- Chapters -->
    
    <link rel="chapter" title="About This Book" href="Preface" />
    <link rel="chapter" title="1 Introduction" href="Introduction" />
    <link rel="chapter" title="2 Syntax" href="Syntax" />
    <link rel="chapter" title="3 Program Structure" href="Program_Structure" />
    <link rel="chapter" title="4 Program Control" href="Program_Control" />
    <link rel="chapter" title="5 Types and Classes" href="Types_and_Classes" />
    <link rel="chapter" title="6 Functions" href="Functions" />
    <link rel="chapter" title="7 Conditions" href="Conditions" />
    <link rel="chapter" title="8 Collections" href="Collections" />
    <link rel="chapter" title="9 Sealing" href="Sealing" />
    <link rel="chapter" title="10 Macros" href="Macros" />
    <link rel="chapter" title="11 The Built-In Classes" href="Built-In_Classes" />
    <link rel="chapter" title="12 The Built-In Functions" href="Built-In_Functions" />
    <link rel="chapter" title="13 Other Built-In Objects" href="Other_Built-In_Objects" />
    <link rel="chapter" title="14 The Built-In Macros and Special Definitions" href="Built-In_Macros_and_Special_Definitions" />
    
    <!-- Appendices -->
    
    <link rel="appendix" title="A BNF" href="BNF" />
    <link rel="appendix" title="B Exported Names" href="Exported_Names" />
    
    <!-- Stylesheets -->
    
    <link rel="stylesheet" href="styles/common.css" type="text/css" />
    <link rel="stylesheet" href="styles/nav-top-fixed.css" type="text/css" media="handheld" />
    <link rel="stylesheet" href="styles/nav-left-fixed.css" type="text/css" media="screen" title="Navigation at Left" />
    <link rel="stylesheet alternate" href="styles/nav-top-fixed.css" type="text/css" media="screen" title="Navigation at Top" />

    <title>Local Declarations &mdash; 14. The Built-In Macros and Special Definitions &mdash; The DRM</title>
  </head>
  <body class="content">

    <div id="header">
      <div id="navigation-header">
	<div id="navigation-top">
	  <div class="background">
	    <p id="book-title">
	    <img class="book-icon" alt="" src="images/color-square-small.png" width="22" height="21" />
	    <a href="Title"><img class="book-title" alt="The Dylan Reference Manual" src="images/book-title.png" width="343" height="28" /></a>
	  </p>
	  <p id="navigation-core">
	    <a class="previous" accesskey="p" title="Previous Page" href="Definition_Macros"><span>&larr; Previous</span></a>
	    <a class="next" accesskey="n" title="Next Page" href="Statement_Macros"><span>Next Page &rarr;</span></a>
	    <a class="up" accesskey="u" title="Chapter Start" href="Built-In_Macros_and_Special_Definitions"><span>Up</span></a>
	    <a class="start" accesskey="s" title="Start of Book" href="Title"><span>Start</span></a>
	    <a class="contents" accesskey="c" title="Contents" href="Contents"><span>Contents</span></a>
	    <a class="index" accesskey="i" title="Index" href="Index"><span>Index</span></a>
	  </p>
	</div>
	</div>
	<div id="navigation-TOC">
	  <ul class="front-matter">
	    <li id="book-start"><a href="Title">Start</a></li>
	    <li><a href="Contents">Contents</a></li>
	    <li><a href="Preface">About This Book</a></li>
	  </ul>
	  <ol class="chapters">
	    <li><a href="Introduction">Introduction</a></li>
	    <li><a href="Syntax">Syntax</a></li>
	    <li><a href="Program_Structure">Program Structure</a></li>
	    <li><a href="Program_Control">Program Control</a></li>
	    <li><a href="Types_and_Classes">Types and Classes</a></li>
	    <li><a href="Functions">Functions</a></li>
	    <li><a href="Conditions">Conditions</a></li>
	    <li><a href="Collections">Collections</a></li>
	    <li><a href="Sealing">Sealing</a></li>
	    <li><a href="Macros">Macros</a></li>
	    <li><a href="Built-In_Classes">The Built-In Classes</a></li>
	    <li><a href="Built-In_Functions">The Built-In Functions</a></li>
	    <li><a href="Other_Built-In_Objects">Other Built-In Objects</a></li>
	    <li class="current parent"><a href="Built-In_Macros_and_Special_Definitions">The Built-In Macros and Special Definitions</a>
	      <ul class="sections">
		<li><a href="Built-In_Macros_and_Special_Definitions_Overview">Overview</a></li>
		<li><a href="Definition_Macros">Definitions</a></li>
		<li id="current"><a href="Local_Declaration_Macros">Local Declarations</a>
		  <ul class="page-TOC">
		    <li><a href="#HEADING-113-63"><code>let</code><span class="attributes-summary"> [Local Declaration]</span></a></li>
		    <li><a href="#HEADING-113-79"><code>local</code><span class="attributes-summary"> [Local Declaration]</span></a></li>
		    <li><a href="#HEADING-113-89"><code>let handler</code><span class="attributes-summary"> [Local Declaration]</span></a></li>
		  </ul>
		</li>
		<li><a href="Statement_Macros">Statements</a></li>
		<li><a href="Function_Macros">Function Macros</a></li>
	      </ul>
	    </li>
	  </ol>
	  <ol class="appendices">
	    <li><a href="BNF">BNF</a></li>
	    <li><a href="Exported_Names">Exported Names</a></li>
	  </ol>
	  <ul class="back-matter">
	    <li><a href="Glossary">Glossary</a></li>
	    <li><a href="Index">Index</a></li>
	    <li><a href="Colophon">Colophon</a></li>
	  </ul>
	  <ul class="errata">
	    <li><a href="Errata">Errata</a></li>
	  </ul>
	</div>
      </div>

      <hr />

    </div>

    <div id="content">
      <div id="section-header">
	<p id="section-prefix">Chapter 14</p>
	<p id="section-name">The Built-In Macros and Special Definitions</p>
      </div>

      <a name="HEADING-113-0"></a>
      <a name="UID-Built-In_Macros-7985"></a>
      <h1 class="section-title"><a name="IX-2029">Local Declarations</a></h1>
      <p>Local declarations are used to create bindings or install handlers that are active for the
	remainder of the innermost body containing the declaration. Bindings created by local
	declarations can be referenced only in the remaining program text of the body. Handlers
	installed are active while the execution of the remainder of the body is active, which
	includes the time during which any functions called from the remainder of the body are
	active.</p>
      <table class="numbered">
	<caption><strong>Table 14-2</strong> Local Declarations</caption>
	<tr>
	  <th class="primary"><p>Macro</p></th>
	  <th><p>Description</p></th>
	  <th><p>Page</p></th>
	</tr><tr>
	  <td><p><code>let</code></p></td>
	  <td><p><a href="#XREF-2031">Creates and initializes new local bindings within the
		smallest enclosing implicit body.</a></p></td>
	  <td><p><a href="#XREF-2031">390</a></p></td>
	</tr><tr>
	  <td><p><code>local</code></p></td>
	  <td><p><a href="#XREF-2035">Creates new local bindings within the smallest enclosing
		implicit body and initializes them to local methods that can be self-recursive and
		mutually recursive.</a></p></td>
	  <td><p><a href="#XREF-2035">391</a></p></td>
	</tr><tr>
	  <td><p><code>let handler</code></p></td>
	  <td><p><a href="#XREF-2038">Establishes a condition handler for the duration of the
		execution of smallest enclosing implicit body.</a></p></td>
	  <td><p><a href="#XREF-2038">392</a></p></td>
	</tr>
      </table>
      <a name="HEADING-113-63"></a>
      <h4 class="item-title" id="let"><a class="here" title="Link to here" href="#let"></a> <span class="signature"><code id="IX-2030">let</code></span> <span class="attributes-summary">[Local Declaration]</span></h4>
      <hr class="item-title" />
      <p class="short-description"><a name="XREF-2031">Creates and initializes new local
	bindings within the smallest enclosing implicit body.</a></p>
      <dl class="Cliche">
	<dt><span>Macro Call:</span></dt>
	<dd><p><code>let</code> <var>variables</var> <code>=</code> <var>init</var> <code>;</code></p></dd>
	<dt><span>Arguments:</span></dt>
	<dd>
	  <dl>
	    <dt><var>variables</var></dt>
	    <dd>
              <p><span class="BNF">variable<em class="BNF"><sub>bnf</sub></em></span> <strong class="re">|</strong> <code>(</code> <span class="BNF">variable-list<em class="BNF"><sub>bnf</sub></em></span> <code>)</code></p>
	    </dd>
	    <dt><var>init</var></dt>
	    <dd><p><span class="BNF">expression<em class="BNF"><sub>bnf</sub></em></span></p></dd>
	</dl></dd>
	<dt><span>Description:</span></dt>
	<dd>
	  <p><code>let</code> creates local bindings for the <var>variables</var>, and initializes
	    them to the values returned by <var>init</var>. The bindings are visible for the remainder
	    of the smallest enclosing implicit body.</p>
	  <p><a name="IX-2032">The first value returned by the <var>init</var> is bound to the
	    first <var>variable</var>, the second value to the second <var>variable</var>, etc.</a>
	    The last <var>variable</var> may be preceded by <code>#rest</code>, in which case it is
	    bound to a sequence containing all the remaining values.</p>
	  <p>Each <var>variable</var> is a variable-name or a variable-name followed by a
	    specializer.</p>
	  <p>If more than one binding is defined, the <var>variables</var> are enclosed in
	    parentheses and separated by commas.</p>
	  <pre class="code">
let start = 0;

let (whole-part, remainder) = truncate(amount);

let (first-value, #rest rest-values) = get-initial-values();</pre>
	  <p><a name="IX-2033">Local variables may be specialized.</a> This ensures that their value
	    will always be of a given type. An attempt to initialize or assign the variable to a
	    value not of that type will signal an error of type <code>&lt;type-error&gt;</code>.</p>
	  <pre class="code">
let elapsed-time :: &lt;integer&gt; = 0;

let the-front-window :: &lt;window&gt; = front-window();

let (whole-part :: &lt;integer&gt;, remainder :: &lt;real&gt;) = truncate(amount);</pre>
	</dd>
      </dl>
      <a name="HEADING-113-79"></a>
      <h4 class="item-title" id="local"><a class="here" title="Link to here" href="#local"></a> <span class="signature"><code id="IX-2034">local</code></span> <span class="attributes-summary">[Local Declaration]</span></h4>
      <hr class="item-title" />
      <p class="short-description"><a name="IX-2036"></a><a name="XREF-2035">Creates new local
	bindings within the smallest enclosing implicit body and initializes them to local methods
	that can be self-recursive and mutually recursive.</a></p>
      <dl class="Cliche">
	<dt><span>Macro Call:</span></dt>
	<dd><p><code>local</code> <strong class="re">{ [</strong> <code>method</code> <strong class="re">]</strong> <var>name parameter-list</var> <strong class="re">[</strong> <var>body</var> <strong class="re">]</strong> <code>end</code> <strong class="re">[</strong> <code>method</code> <strong class="re">] [</strong> <var>name</var> <strong class="re">] }</strong> <code>,</code><strong class="re"><sup>+</sup></strong></p></dd>
	<dt><span>Arguments:</span></dt>
	<dd>
	  <dl>
	    <dt><var>name</var></dt>
	    <dd><p><span class="BNF">variable-name<em class="BNF"><sub>bnf</sub></em></span></p></dd>
	    <dt><var>parameter-list</var></dt>
	    <dd><p>parameter-list<em><sub>bnf</sub></em></p></dd>
	    <dt><var>body</var></dt>
	    <dd><p><span class="BNF">body<em class="BNF"><sub>bnf</sub></em></span></p></dd>
	</dl></dd>
	<dt><span>Description:</span></dt>
	<dd>
	  <p><code>local</code> creates local methods that may be mutually recursive and
	    self-recursive.</p>
	  <p>Each <var>name</var> creates a new local binding. The binding is initialized to a new
	    method specified by the <var>parameter-list</var> and <var>body</var>. In addition to
	    being visible for the remainder of the smallest enclosing implicit body, the bindings
	    created for the <var>names</var> are visible to the <var>parameter-lists</var>
	    and <var>bodies</var> of all the methods created by the <code>local</code>
	    declaration.</p>
	  <p>The <var>parameter-list</var> is a standard method parameter list. A complete
	    description of parameter lists is given
	    in <a href="Parameter_Lists#XREF-782"><q>Parameter Lists</q> on page 84</a>.</p>
	  <p>The <var>body</var> is an implicit body.</p></dd>
      </dl>
      <a name="HEADING-113-89"></a>
      <h4 class="item-title" id="let_handler"><a class="here" title="Link to here" href="#let_handler"></a> <span class="signature"><code id="IX-2037">let handler</code></span> <span class="attributes-summary">[Local Declaration]</span></h4>
      <hr class="item-title" />
      <p class="short-description"><a name="IX-2039"></a><a name="XREF-2038">Establishes a condition
	handler for the duration of the execution of smallest enclosing implicit body.</a></p>
      <dl class="Cliche">
	<dt><span>Macro Call:</span></dt>
	<dd><p><code>let handler</code> <var>condition</var> <code>=</code> <var>handler</var></p></dd>
	<dt><span>Arguments:</span></dt>
	<dd>
	  <dl>
	    <dt><var>condition</var></dt>
	    <dd><p><var>type</var> <strong class="re">|</strong> <code>(</code> <var>type</var> <strong class="re">{</strong> <code>,</code> <var>option</var> <strong class="re">}*</strong> <code>)</code></p></dd>
	    <dt><var>type</var></dt>
	    <dd><p><span class="BNF">expression<em class="BNF"><sub>bnf</sub></em></span></p></dd>
	    <dt><var>option</var></dt>
	    <dd><p><var>test-option</var> <strong class="re">|</strong> <var>init-option</var></p></dd>
	    <dt><var>test-option</var></dt>
	    <dd><p><code>test:</code> <span class="BNF">expression<em class="BNF"><sub>bnf</sub></em></span></p></dd>
	    <dt><var>init-option</var></dt>
	    <dd><p><code>init-arguments:</code> <span class="BNF">expression<em class="BNF"><sub>bnf</sub></em></span></p></dd>
	    <dt><var>handler</var></dt>
	    <dd><p><span class="BNF">expression<em class="BNF"><sub>bnf</sub></em></span></p></dd>
	</dl></dd>
	<dt><span>Description:</span></dt>
	<dd>
	  <p><code>let handler</code> establishes a new condition handler that is in effect for the
	    duration of the execution of the remainder of the smallest enclosing implicit body. Unlike
	    the local declarations <code>let</code> and <code>local</code>, <code>let handler</code>
	    does not create any bindings.</p>
	  <ul>
	    <li>The <var>condition</var> describes the conditions for which the handler is
	      applicable.
	      <ul>
		<li>The <var>type</var> is the type of the applicable conditions. The handler will
		  be applicable to conditions that are general instances of <var>type</var>.</li>
		<li>The <var>test-option </var> is a function that is called to further test the
		  applicability of the handler. When a condition of type <var>type</var> is
		  signaled, the test function will be called with that condition as an argument. If
		  the test returns true, the handler is considered applicable to the condition. If
		  the test returns false, the handler is considered to be inapplicable to the
		  condition. The default value of this option is a function that always returns
		  true. There can be at most one <var>test-option</var>.<br /><br />An example use
		  for this feature is a restart handler for restarting only from a particular
		  condition object, for example restarting from an unbound-slot error by setting the
		  slot and retrying the invocation of the
		  accessor. The <code>&lt;set-and-continue&gt;</code> restart condition will have
		  the signaled <code>&lt;unbound-slot&gt;</code> condition in a slot, and the
		  handler's test will check for it. (These class names are invented for this example
		  and are not part of the specification.)</li>
		<li>The <var>init-option</var> is a sequence of alternating keywords and objects
		  that can be used as initialization arguments to construct a condition to which the
		  handler is applicable. For example, if the handler is a restart handler, a program
		  could retrieve the <var>init-option</var> by calling <code>do-handlers</code>, and
		  could then use them to construct a corresponding restart. There can be at most
		  one <var>init-option</var>. <var>init-option</var> defaults to an empty
		  sequence.</li>
	      </ul>
	    </li>
	    <li>The <var>handler</var> is a function called to handle a condition that
	      matches <var>type</var> and passes <var>test-option</var>. The function should accept
	      two arguments. The first argument will be the condition being signaled, and the second
	      argument will be a next-handler function. The handler handles the condition by taking
	      a nonlocal exit, returning values according to the condition's recovery protocol, or
	      tail-recursively calling <code>signal</code> of a restart. The function can decline to
	      handle the condition by tail-recursively calling the next-handler function with no
	      arguments.</li>
	  </ul>
	  <p><var>test-option</var> and <var>handler</var> are distinct so that handler
	    applicability can be tested without actually handling (which might take a nonlocal
	    exit). One use for this is constructing a list of available restart handlers.</p>
	  <p>There is no <q>condition wall,</q> i.e., when executing <var>handler </var> the set of
	    available handlers is not reset to the handlers that were in effect when the <code>let
	      handler</code> was entered.</p>
	  <p>Implementations are encouraged to implement <code>let handler</code> in a way that
	    optimizes establishing a handler for both speed and space, even if that increases the
	    cost of signaling. The assumption is that most of the time a handler will never be used,
	    because the exception it is looking for will never occur.</p>
	  <p><var>type</var>, <var>handler</var>, <var>test-option</var>, and <var>init-option</var>
	    are executed before execution of the rest of the enclosing body
	    begins.<a name="IX-2040"></a></p>
	</dd>
      </dl>

    </div>

    <div id="footer">

      <hr />
      <address>The Dylan Reference Manual - 7 Apr 1998</address>
      <p id="navigation-footer">
	<a class="previous" accesskey="p" title="Previous Page" href="Definition_Macros"><span>&larr; Previous</span></a>
	<a class="next" accesskey="n" title="Next Page" href="Statement_Macros"><span>Next Page &rarr;</span></a>
	<a class="up" accesskey="u" title="Chapter Start" href="Built-In_Macros_and_Special_Definitions"><span>Up</span></a>
	<a class="start" accesskey="s" title="Start of Book" href="Title"><span>Start</span></a>
	<a class="contents" accesskey="c" title="Contents" href="Contents"><span>Contents</span></a>
	<a class="index" accesskey="i" title="Index" href="Index"><span>Index</span></a>
      </p>
      <p>Copyright Apple Computer, Inc. 1996. Apple&reg; and the Apple logo are registered
	trademarks of Apple Computer, Inc. Used with permission. All Rights Reserved.</p>
      <p>Originally generated with Harlequin WebMaker&reg;, subsequently revised.</p>
    </div>
  </body>
</html>
