<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
  <head>
    
    <!-- Relative Navigation -->
    
    <link rel="up" href="Types_and_Classes" />
    <link rel="prev" href="Type_Protocol" />
    <link rel="next" href="Slots" />
    
    <!-- Absolute Navigation -->
    
    <link rel="top" href="Title" />
    <link rel="start first" href="." />
    <link rel="copyright" href="Copyrights" />
    <link rel="contents" href="Contents" />
    <link rel="glossary" href="Glossary" />
    <link rel="index" href="Index" />
    <link rel="last author" href="Colophon" />
    
    <!-- Chapters -->
    
    <link rel="chapter" title="About This Book" href="Preface" />
    <link rel="chapter" title="1 Introduction" href="Introduction" />
    <link rel="chapter" title="2 Syntax" href="Syntax" />
    <link rel="chapter" title="3 Program Structure" href="Program_Structure" />
    <link rel="chapter" title="4 Program Control" href="Program_Control" />
    <link rel="chapter" title="5 Types and Classes" href="Types_and_Classes" />
    <link rel="chapter" title="6 Functions" href="Functions" />
    <link rel="chapter" title="7 Conditions" href="Conditions" />
    <link rel="chapter" title="8 Collections" href="Collections" />
    <link rel="chapter" title="9 Sealing" href="Sealing" />
    <link rel="chapter" title="10 Macros" href="Macros" />
    <link rel="chapter" title="11 The Built-In Classes" href="Built-In_Classes" />
    <link rel="chapter" title="12 The Built-In Functions" href="Built-In_Functions" />
    <link rel="chapter" title="13 Other Built-In Objects" href="Other_Built-In_Objects" />
    <link rel="chapter" title="14 The Built-In Macros and Special Definitions" href="Built-In_Macros_and_Special_Definitions" />
    
    <!-- Appendices -->
    
    <link rel="appendix" title="A BNF" href="BNF" />
    <link rel="appendix" title="B Exported Names" href="Exported_Names" />
    
    <!-- Stylesheets -->
    
    <link rel="stylesheet" href="styles/common.css" type="text/css" />
    <link rel="stylesheet" href="styles/nav-top-fixed.css" type="text/css" media="handheld" />
    <link rel="stylesheet" href="styles/nav-left-fixed.css" type="text/css" media="screen" title="Navigation at Left" />
    <link rel="stylesheet alternate" href="styles/nav-top-fixed.css" type="text/css" media="screen" title="Navigation at Top" />

    <title>Classes &mdash; 5. Types and Classes &mdash; The DRM</title>
  </head>
  <body class="content">

    <div id="header">
      <div id="navigation-header">
	<div id="navigation-top">
	  <div class="background">
	    <p id="book-title">
	    <img class="book-icon" alt="" src="images/color-square-small.png" width="22" height="21" />
	    <a href="Title"><img class="book-title" alt="The Dylan Reference Manual" src="images/book-title.png" width="343" height="28" /></a>
	  </p>
	  <p id="navigation-core">
	    <a class="previous" accesskey="p" title="Previous Page" href="Type_Protocol"><span>&larr; Previous</span></a>
	    <a class="next" accesskey="n" title="Next Page" href="Slots"><span>Next Page &rarr;</span></a>
	    <a class="up" accesskey="u" title="Chapter Start" href="Types_and_Classes"><span>Up</span></a>
	    <a class="start" accesskey="s" title="Start of Book" href="Title"><span>Start</span></a>
	    <a class="contents" accesskey="c" title="Contents" href="Contents"><span>Contents</span></a>
	    <a class="index" accesskey="i" title="Index" href="Index"><span>Index</span></a>
	  </p>
	</div>
	</div>
	<div id="navigation-TOC">
	  <ul class="front-matter">
	    <li id="book-start"><a href="Title">Start</a></li>
	    <li><a href="Contents">Contents</a></li>
	    <li><a href="Preface">About This Book</a></li>
	  </ul>
	  <ol class="chapters">
	    <li><a href="Introduction">Introduction</a></li>
	    <li><a href="Syntax">Syntax</a></li>
	    <li><a href="Program_Structure">Program Structure</a></li>
	    <li><a href="Program_Control">Program Control</a></li>
	    <li class="current parent"><a href="Types_and_Classes">Types and Classes</a>
	      <ul class="sections">
		<li><a href="Types_and_Classes_Overview">Overview</a></li>
		<li><a href="Type_Protocol">The Type Protocol</a></li>
		<li id="current" class="subsections"><a href="Classes">Classes</a>
		  <ul class="page-TOC">
		    <li><a href="#HEADING-41-5">Features of Classes</a></li>
		    <li><a href="#HEADING-41-11">Creating Classes</a></li>
		    <li><a href="#HEADING-41-19">Class Inheritance</a></li>
		    <li><a href="#HEADING-41-25">Computing the Class Precedence List</a></li>
		  </ul>
		</li>
		<li><a href="Slots">Slots</a></li>
		<li><a href="Instance_Creation_and_Initialization">Instance Creation and Initialization</a></li>
		<li><a href="Singletons">Singletons</a></li>
		<li><a href="Union_Types">Union Types</a></li>
		<li><a href="Limited_Types">Limited Types</a></li>
	      </ul>
	    </li>
	    <li><a href="Functions">Functions</a></li>
	    <li><a href="Conditions">Conditions</a></li>
	    <li><a href="Collections">Collections</a></li>
	    <li><a href="Sealing">Sealing</a></li>
	    <li><a href="Macros">Macros</a></li>
	    <li><a href="Built-In_Classes">The Built-In Classes</a></li>
	    <li><a href="Built-In_Functions">The Built-In Functions</a></li>
	    <li><a href="Other_Built-In_Objects">Other Built-In Objects</a></li>
	    <li><a href="Built-In_Macros_and_Special_Definitions">The Built-In Macros and Special Definitions</a></li>
	  </ol>
	  <ol class="appendices">
	    <li><a href="BNF">BNF</a></li>
	    <li><a href="Exported_Names">Exported Names</a></li>
	  </ol>
	  <ul class="back-matter">
	    <li><a href="Glossary">Glossary</a></li>
	    <li><a href="Index">Index</a></li>
	    <li><a href="Colophon">Colophon</a></li>
	  </ul>
	  <ul class="errata">
	    <li><a href="Errata">Errata</a></li>
	  </ul>
	</div>
      </div>

      <hr />

    </div>

    <div id="content">
      <div id="section-header">
	<p id="section-prefix">Chapter 5</p>
	<p id="section-name">Types and Classes</p>
      </div>

      <a name="HEADING-41-0"></a>
      <a name="UID-Types_and_Classes-361"></a>
      <h1 class="section-title"><a name="IX-561">Classes</a></h1>
      <p><a name="IX-562">Classes</a> are used to define the inheritance, structure, and
	initialization of objects.</p>
      <p>Every object is a <dfn id="IX-563">direct instance</dfn> of exactly one class, and a
	general instance of the <dfn id="IX-564">general superclasses</dfn> of that class.</p>
      <p>A class determines which <dfn id="IX-565">slots</dfn> its instances have. Slots are
	the local storage available within instances. They are used to store the state of
	objects.</p>
      <p>Classes determine how their instances are initialized by using
	the <dfn id="IX-566">initialization protocol</dfn>.</p>
      <a name="HEADING-41-5"></a>
      <a name="UID-Types_and_Classes-5438"></a>
      <h2 class="subsection-title"><a name="IX-567">Features of Classes</a></h2>
      <p>There are four features of classes. These features relate to each other, but can be
	declared independently.</p>
      <ul>
	<li>A class can be <dfn id="IX-568">abstract</dfn>
	  or <dfn id="IX-569">concrete</dfn>. If the class is concrete, it can have direct
	  instances. If it is abstract, it cannot have direct instances, but only indirect
	  instances.</li>
	<li>A class can be <dfn id="IX-570">instantiable</dfn>
	  or <dfn id="IX-571">uninstantiable</dfn>. If the class is instantiable, it can be
	  used as the first argument to <code>make</code>. If it is uninstantiable, it cannot be
	  used as the first argument to <code>make</code>.</li>
	<li>A class can be <dfn id="IX-572">primary</dfn>
	  or <dfn id="IX-573">free</dfn>. This controls how a class can be used for multiple
	  inheritance. For a full description of this feature,
	  see <a href="Declaring_Characteristics_of_Classes#XREF-1106"><q>Declaring
	  Characteristics of Classes</q> on page 134</a>.</li>
	<li>A class can be <dfn id="IX-574">sealed</dfn>
	  or <dfn id="IX-575">open</dfn>. This controls whether a class can be subclassed
	  outside the library where it is defined. For a full description of this feature,
	  see <a href="Declaring_Characteristics_of_Classes#XREF-1106"><q>Declaring
	  Characteristics of Classes</q> on page 134</a>.<a name="IX-576"></a></li>
      </ul>
      <a name="HEADING-41-11"></a>
      <a name="UID-Types_and_Classes-2532"></a>
      <h2 class="subsection-title"><a name="IX-577">Creating Classes</a></h2>
      <p>New classes may be created by calling <code id="IX-578">make</code>
	on <code>&lt;class&gt;</code>, or with the definition <code id="IX-579">define
	class</code>. In most programs the latter is more commonly used.</p>
      <p>When a class is created with <code>make</code>, it is instantiated and returned just like
	any other object. The options available when creating a class with <code>make</code> are
	described on <a href="Type_Classes#XREF-1372">page 191</a>.</p>
      <p><a name="IX-580">When a class is created</a> with <code>define class</code> it is
	used to initialize a new module binding. <code>define class</code> allows the specification
	of superclasses, slots, initialization behavior, and options related to sealing. The
	complete syntax of <code>define class</code> is given
	on <a href="Definition_Macros#XREF-2013">page 378</a>.</p>
      <p>The following simple class definition creates a class named by the module
	binding <code>&lt;new&gt;</code>. The class inherits from <code>&lt;object&gt;</code> and
	does not specify any slots.</p>
      <pre class="code">
define class &lt;new&gt; (&lt;object&gt;)
end class &lt;new&gt;;
</pre>
      <p>The following class definition illustrates the creation of a class with multiple
	superclasses. Again, there are no slots defined by the class.</p>
      <pre class="code">
define class &lt;color-window&gt; (&lt;palette&gt;, &lt;window&gt;)
end class &lt;color-window&gt;;<a name="IX-581"></a>
</pre>
      <a name="HEADING-41-19"></a>
      <a name="UID-Types_and_Classes-5460"></a>
      <h2 class="subsection-title"><a name="XREF-583"></a><a name="IX-582">Class Inheritance</a></h2>
      <p>When a class is created, its <dfn id="IX-584">direct superclasses</dfn> are
	specified. The new class directly inherits from these classes; it is
	a <dfn id="IX-585">direct subclass</dfn> of each of these classes. There can be no
	duplicates in the direct superclasses of a class.</p>
      <p>The subclass relationship is transitive. If a class <var>C</var> is a direct subclass
	of <var>C<em><sub>1</sub></em></var>, <var>C<em><sub>1</sub></em></var> is a direct subclass
	of <var>C<em><sub>2</sub></em></var>, and <var>C<em><sub>2</sub></em></var> is a direct
	subclass of <var>C<em><sub>3</sub></em></var>, then <var>C</var> is
	an <dfn id="IX-586">indirect subclass</dfn> of <var>C<em><sub>2</sub></em></var>
	and <var>C<em><sub>3</sub></em></var>. A <dfn id="IX-587">general subclass</dfn> is a
	direct or indirect subclass.</p>
      <p>Inheritance cannot be <a name="IX-588">circular</a>. A class cannot be its own
	general subclass.</p>
      <p>A class is a subtype of each of its general superclasses.</p>
      <p>Every class is a general subclass of <code>&lt;object&gt;</code>.<a name="IX-589"></a></p>
      <a name="HEADING-41-25"></a>
      <a name="UID-Types_and_Classes-7969"></a>
      <h2 class="subsection-title"><a name="XREF-590"></a><a name="IX-591">Computing the Class Precedence List</a></h2>
      <p>The definition of a class specifies a <a name="IX-592">total ordering</a> on that
	class and its direct superclasses. This ordering is called the <dfn id="IX-593">local
	precedence order</dfn>. In the local precedence order:</p>
      <ul>
	<li>The class precedes its direct superclasses.</li>
	<li>Each direct superclass precedes all other direct superclasses that follow it in the
	  sequence of direct superclasses given in the class definition.</li>
      </ul>
      <p>The <dfn id="IX-594">class precedence list</dfn> for a class <var>C</var> is a total
	ordering on <var>C</var> and its superclasses that is consistent with the local precedence
	order of <var>C</var> and with the class precedence lists of its superclasses. (Two lists
	are consistent if for every <var>A</var> and <var>B</var> that are each members of both
	lists, either <var>A</var> precedes <var>B</var> in both or <var>B</var>
	precedes <var>A</var> in both.) The class precedence list is used in determining the order
	of specificity of methods based on the types they are specialized on when dispatching; for
	details, see <a href="Method_Dispatch#XREF-844"><q>Method Dispatch</q> on page 95</a>.</p>
      <p>Sometimes there are several such consistent total orderings on <var>C</var> and its
	superclasses. Dylan uses a deterministic algorithm to compute the class precedence list, which
	chooses one of the consistent total orderings.</p>
      <p>Sometimes there is no possible total ordering on <var>C</var> and its superclasses that is
	consistent with the local precedence orders for <var>C</var> and with the class precedence
	lists of its superclasses. In this case, the class precedence list cannot be computed, and an
	error is signaled.</p>
      <p>Note that because the class precedence list for a class is consistent with the class
	precedence lists of its superclasses, inheritance in Dylan is <dfn>monotonic</dfn>. That is,
	if a generic function call using a direct instance of <var>C</var> dispatches to a method
	specialized in that parameter position on an indirect superclass of <var>C</var>, then there
	is a direct superclass of <var>C</var> that has the same behavior.</p>
      <p>To compute the class precedence list for class <var>C</var>, merge the local precedence
	order of the class with the class precedence lists of the direct superclasses of the
	class. Computing the class precedence list for <var>C</var> requires computing the class
	precedence lists for its superclasses. This does not lead to infinite recursion because
	circular class inheritance is prohibited.</p>
      <p>Note that because the class precedence lists of the direct superclasses
	are <a name="IX-595">consistent</a> with their local precedence orders and with the class
	precedence lists of their direct superclasses, and so on, the class precedence list
	for <var>C</var> is consistent with the local precedence orders and class precedence lists
	of all its superclasses and not just the direct superclasses.</p>
      <p>The merge of several sequences is a sequence that contains each of the elements of the
	several input sequences. An element that appears in more than one of the input sequences
	appears only once in the output sequence. If two elements appear in the same input sequence,
	their order in the output sequence is the same as their order in that input sequence.</p>
      <p>When there are several possible merges of the inputs, at each position in the output where
	there is a choice, pick the class that has a direct subclass closest to the end of the output
	sequence. (This is unambiguous because two candidates for a position cannot both be direct
	superclasses of the same class, since they would then be ordered by that class's local
	precedence order. This is easily computable because a class always follows its direct
	subclasses in the merge, therefore the most recently added direct subclass can be found by
	searching from the end to the beginning of the output sequence and the merge can be computed
	in one pass.)</p>
      <p>This algorithm can be implemented with the following Dylan program:</p>
      <pre class="code">
define constant compute-class-linearization =
  method (c :: &lt;class&gt;) =&gt; (cpl :: &lt;list&gt;)
    local method merge-lists (reversed-partial-result :: &lt;list&gt;,
                              remaining-inputs :: &lt;sequence&gt;)
            if (every?(empty?, remaining-inputs))
              reverse!(reversed-partial-result)
            else
              local method candidate (c :: &lt;class&gt;)
                      // returns c if it can go in the result now,
                      // otherwise false
                      local method head? (l :: &lt;list&gt;)
                              c == head(l)
                            end method head?,
                            method tail? (l :: &lt;list&gt;)
                              member?(c, tail(l))
                            end method tail?;
                      any?(head?, remaining-inputs)
                        &amp; ~any?(tail?, remaining-inputs)
                        &amp; c
                    end method candidate,
                    method candidate-direct-superclass (c :: &lt;class&gt;)
                      any?(candidate, direct-superclasses(c))
                    end method candidate-direct-superclass;
              let next = any?(candidate-direct-superclass,
                              reversed-partial-result);
              if (next)
                local method remove-next (l :: &lt;list&gt;)
                        if (head(l) == next) tail(l) else l end
                      end method remove-next;
                merge-lists(pair(next, reversed-partial-result),
                            map(remove-next, remaining-inputs))
              else
                error("Inconsistent precedence graph");
              end if
            end if
          end method merge-lists;
    let c-direct-superclasses = direct-superclasses(c);
    local method cpl-list (c)
            as(&lt;list&gt;, all-superclasses(c))
          end method cpl-list;
    merge-lists(list(c),
                add(map(cpl-list, c-direct-superclasses),
                    as(&lt;list&gt;, c-direct-superclasses)));
  end method; // compute-class-linearization
</pre>
      <p>Note that the selection rule from above is enforced because <code>any?</code> uses the
	natural iteration order for sequences and returns the first true value it encounters when
	searching the reversed partially computed class precedence
	list.<a name="IX-596"></a><a name="IX-597"></a><a name="IX-598"></a></p>

    </div>

    <div id="footer">

      <hr />
      <address>The Dylan Reference Manual - 7 Apr 1998</address>
      <p id="navigation-footer">
	<a class="previous" accesskey="p" title="Previous Page" href="Type_Protocol"><span>&larr; Previous</span></a>
	<a class="next" accesskey="n" title="Next Page" href="Slots"><span>Next Page &rarr;</span></a>
	<a class="up" accesskey="u" title="Chapter Start" href="Types_and_Classes"><span>Up</span></a>
	<a class="start" accesskey="s" title="Start of Book" href="Title"><span>Start</span></a>
	<a class="contents" accesskey="c" title="Contents" href="Contents"><span>Contents</span></a>
	<a class="index" accesskey="i" title="Index" href="Index"><span>Index</span></a>
      </p>
      <p>Copyright Apple Computer, Inc. 1996. Apple&reg; and the Apple logo are registered
	trademarks of Apple Computer, Inc. Used with permission. All Rights Reserved.</p>
      <p>Originally generated with Harlequin WebMaker&reg;, subsequently revised.</p>
    </div>
  </body>
</html>
